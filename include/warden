#!/bin/bash

# By Rainman
# V20211112
# 0.0.2.8

source /usr/local/bin/include/color

# date for logs
LOG_DATE=$(date '+%Y-%d-%mT%TZ' 2>&1)
# pi of trumpcoind
PIDOFTRUMP=$(pidof trumpcoind 2>&1 | wc -w 2>&1)

if echo "$PIDOFTRUMP" 2>&1 |
  wc -l 2>&1 | grep -q -E "1"; then
  printf '%b' "${LOG_DATE:?} Status() WalletMonitor.: Wallet ok${N0:?}\n" >>/home/"$(whoami)"/TrumpCoin/debug.log 2>&1
else
  truncate -s 0 /home/"$(whoami)"/TrumpCoin/debug.log 2>&1
  # pitrump configurations
  source /home/pi/pitrump.conf
  # make sure tor is installed
  if ! [ -x "$(command -v tor)" ]; then
    sudo apt-get install tor -y
    echo "Setup tor/wallet configurations!"
  fi
  printf '%b' "${LOG_DATE:?} Status() WalletMonitor.: Starting wallet daemon..${N0:?}\n" >>/home/"$(whoami)"/TrumpCoin/debug.log 2>&1
  "$WALLET_DIR"/trumpcoind -datadir="$WALLET_DIR" -conf="$WALLET_DIR"/trumpcoin.conf -proxy=127.0.0.1:9050 -daemon
fi
